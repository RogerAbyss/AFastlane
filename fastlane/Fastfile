# Fastfile 
# Copyright@2017 Abyss

fastlane_version ENV["FASTLANE_VERSION_MIN"]
default_platform :ios

platform :ios do
	before_all do
	end

	desc 'æž„å»ºæµ‹è¯•ç‰ˆ'
	override_lane :test do |options|

		# èŽ·å–å‚æ•°
		lane          = ENV["FASTLANE_LANE_NAME"]
		adminer       = ENV["APP_ADMINER"]
		token         = ENV["APP_FIR_TOKEN"]
		scheme		  = ENV["APP_SCHEME"]
	   
		# ç¡®è®¤gitçŠ¶æ€å¥åº·
		# ç¡®è®¤gitåˆ†æ”¯æ­£ç¡®
		# 
		before

		# complete

		# # èŽ·å–æœ€æ–°çš„git
		# # Warning åªä¼šå¤„ç†å½“å‰åˆ†æ”¯
		# git_pull
	   
		# # æ›´æ–°ä¸‰æ–¹åº“æ–‡ä»¶
		# pod_update
	   
		# # ä¿®æ”¹Appæœ¬åœ°é…ç½®ä¿¡æ¯
		# change
	   
		# # åŒ¹é…è¯ä¹¦
		# match

		# # ç­¾å
		# enable_automatic_code_signing(
		# 	team_id: ENV["APP_TEAMID_TEST"]
		# )

		# # ç¼–è¯‘/æ‰“åŒ…
		# gym
	   
	   
		#  # ä¸Šä¼ Fir
		#  path  = lane_context[SharedValues::IPA_OUTPUT_PATH]
		#  msg   = "[#{lane}] - automatic build by #{adminer}"
	   
		#  UI.important "Upload Fir.im\n#{msg}"
	   
		#  system "fir publish #{path} -T #{token} -c #{msg}"
	   
		#  # èŽ·å–ç‰ˆæœ¬å·
		#  version = get_version_number(xcodeproj: "#{scheme}.xcodeproj")
		#  UI.important "#{version}"
		#  # å‘é€é‚®ä»¶
		#  email(version: version)
	   
		#  # æäº¤git
		#  git_add(path: '.')
		#  git_commit(path: '.', message: "chore: ðŸš€[#{lane}] - Automatic version UP")
	end
	
	private_lane :before do |options|
		ensure_git_status_clean

		branch = ENV["APP_SETTING_GIT_BRANCH"]
		if branch.length > 0
			ensure_git_branch(
				branch: branch
		  	)
		end
	end

	after_all do
	end
end