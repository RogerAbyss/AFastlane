desc 'æµ‹è¯•ç‰ˆ,ä¸Šä¼ Fir'
override_lane :test do |options|

  # è·å–å‚æ•°
  lane          = ENV["FASTLANE_LANE_NAME"]
  adminer       = ENV["APP_ADMINER"]
  token         = ENV["APP_FIR_TOKEN"]
  scheme		   	= ENV["APP_SCHEME"]

	# è·å–æœ€æ–°çš„git
	# Warning åªä¼šå¤„ç†å½“å‰åˆ†æ”¯
	git_pull

	# æ›´æ–°ä¸‰æ–¹åº“æ–‡ä»¶
	pod_update

  # ä¿®æ”¹Appæœ¬åœ°é…ç½®ä¿¡æ¯
  change

  # åŒ¹é…è¯ä¹¦
  match
  # ç­¾å
  # enable_automatic_code_signing(
  #   team_id: ENV["APP_TEAMID_TEST"]
  # )
  # ç¼–è¯‘/æ‰“åŒ…
  gym


  # ä¸Šä¼ Fir
  path  = lane_context[SharedValues::IPA_OUTPUT_PATH]
  msg   = "[#{lane}] - automatic build by #{adminer}"

  UI.important "Upload Fir.im\n#{msg}"

  system "fir publish #{path} -T #{token} -c #{msg}"

  # è·å–ç‰ˆæœ¬å·
  version = get_version_number(xcodeproj: "#{scheme}.xcodeproj")
  UI.important "#{version}"
  # å‘é€é‚®ä»¶
  email(version: version)

  # æäº¤git
  git_add(path: '.')
  git_commit(path: '.', message: "chore: ğŸš€[#{lane}] - Automatic version UP")
end

# ======================================================================
# ======================================================================
# ======================================================================

desc 'ä¿®æ”¹Appæœ¬åœ°ä¿¡æ¯'
private_lane :change do |options|

	lane 				      = ENV["FASTLANE_LANE_NAME"]
	scheme		   	  	= ENV["APP_SCHEME"]
	appname 			    = ENV["APP_NAME"]
	appname_release 	= ENV["APP_NAME_RELEASE"]

	# å–ä¸åŒçš„APP_IDENTIFIER
	lane_key = lane.upcase
	app_identifier 		= ENV["APP_IDENTIFIER_#{lane_key}"]


	UI.important "å½“å‰ç‰ˆæœ¬:#{lane}"
	if lane.to_s == "release"
		appname = appname_release
	elsif
		appname = appname + lane
	end

	# æ­¤æ–¹æ³•å¹¶æ²¡æœ‰æˆåŠŸä¿®æ”¹ PRODUCT_BUNDLE_IDENTIFIER 
	# Warning - ç”¨æ­¤æ–¹æ³•ä¿®æ”¹app_identifier, åè€Œå¯¼è‡´PRODUCT_BUNDLE_IDENTIFIERé”™ä¹±æ— æ³•æˆåŠŸåŒ¹é…
	update_info_plist(
		plist_path: "#{scheme}/Info.plist",
      	display_name: appname,
  	)

  	update_app_identifier(
  		plist_path: "#{scheme}/Info.plist",
      	app_identifier: app_identifier,
  	)

  	UI.important "\nä¿®æ”¹AppDisplayName:#{appname}\nä¿®æ”¹Identifier:#{app_identifier}"

	# è‡ªåŠ¨å¢åŠ ç‰ˆæœ¬å·
	# Warning è¯·ä½¿ç”¨x.x.xæ ‡å‡†ç‰ˆæœ¬å·
  	increment_build_number
  	increment_version_number
end